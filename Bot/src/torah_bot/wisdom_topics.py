#!/usr/bin/env python3
"""
WisdomTopicGenerator - Unique topic generation for Torah wisdom broadcasts

This module provides functionality to generate unique topics for wisdom broadcasts,
preventing content repetition by tracking recent topics in the database.

Analogous to QuizTopicGenerator but for wisdom content.
"""
import asyncio
import asyncpg
import logging
from typing import List, Optional
from datetime import datetime, date, timedelta
from random import choice, sample

logger = logging.getLogger(__name__)

class WisdomTopicGenerator:
    """Generate unique wisdom topics to prevent content repetition"""

    # EXPANDED: 100+ diverse wisdom topics for unique content (October 2025)
    BASE_WISDOM_TOPICS = [
        # Core spiritual values (20 topics)
        "–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å –∏ –¥—É—Ö–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç–∞–≤–ª–µ–Ω–∏–µ",
        "–∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏ –∏–∑ –¢–æ—Ä—ã",
        "–º—É–¥—Ä–æ—Å—Ç—å –ø—Ä–∞–≤–µ–¥–Ω–∏–∫–æ–≤ –∏ –¥—É—Ö–æ–≤–Ω—ã–π —Ä–æ—Å—Ç",
        "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∏ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –≤ –∂–∏–∑–Ω–∏",
        "–¥–æ–±—Ä–æ—Ç–∞ –∏ –ø–æ–º–æ—â—å –±–ª–∏–∂–Ω–∏–º",
        "—Å–µ–º–µ–π–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ª—é–±–æ–≤—å",
        "–ø–æ–∫–æ–π –¥—É—à–∏ –∏ –¥—É—Ö–æ–≤–Ω–æ–µ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ",
        "—Ä–∞–¥–æ—Å—Ç—å –≤ —Å–ª—É–∂–µ–Ω–∏–∏ –∏ –∏–∑—É—á–µ–Ω–∏–∏ –¢–æ—Ä—ã",
        "—Ç–µ—Ä–ø–µ–Ω–∏–µ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≤ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è—Ö",
        "—á–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–≤–µ–¥–Ω–æ—Å—Ç—å –≤ –ø–æ—Å—Ç—É–ø–∫–∞—Ö",
        "–º–æ–ª–∏—Ç–≤–∞ –∏ —Å–≤—è–∑—å —Å –í—Å–µ–≤—ã—à–Ω–∏–º",
        "–ø—Ä–æ—â–µ–Ω–∏–µ –∏ –æ—á–∏—â–µ–Ω–∏–µ –¥—É—à–∏",
        "–º—É–¥—Ä–æ—Å—Ç—å —Å—Ç–∞—Ä—Ü–µ–≤ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π –æ–ø—ã—Ç",
        "–Ω–∞–¥–µ–∂–¥–∞ –∏ –≤–µ—Ä–∞ –≤ —Ç—Ä—É–¥–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞",
        "–µ–¥–∏–Ω—Å—Ç–≤–æ –Ω–∞—Ä–æ–¥–∞ –∏ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â—å",
        "—É—á–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞–Ω–∏–π",
        "—Å–º–∏—Ä–µ–Ω–∏–µ –∏ –¥—É—Ö–æ–≤–Ω–∞—è —Å–∫—Ä–æ–º–Ω–æ—Å—Ç—å",
        "—Ä–∞–¥–æ—Å—Ç—å –≤ –ø—Ä–æ—Å—Ç—ã—Ö –≤–µ—â–∞—Ö –∂–∏–∑–Ω–∏",
        "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä –∏ –≥–∞—Ä–º–æ–Ω–∏—è –¥—É—à–∏",
        "–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∑–∞–±–æ—Ç–∞ –æ –¥—Ä—É–≥–∏—Ö",
        
        # Relationships and community (15 topics)
        "–º—É–¥—Ä–æ—Å—Ç—å –≤ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–∏ –¥–µ—Ç–µ–π –∏ –ø–µ—Ä–µ–¥–∞—á–µ —Ç—Ä–∞–¥–∏—Ü–∏–π",
        "—Å—É–ø—Ä—É–∂–µ—Å–∫–∞—è –ª—é–±–æ–≤—å –∏ –≥–∞—Ä–º–æ–Ω–∏—è –≤ –¥–æ–º–µ",
        "—É–≤–∞–∂–µ–Ω–∏–µ –∫ —Ä–æ–¥–∏—Ç–µ–ª—è–º –∏ —Å—Ç–∞—Ä—à–µ–º—É –ø–æ–∫–æ–ª–µ–Ω–∏—é",
        "–¥—Ä—É–∂–±–∞ –∏ –≤–µ—Ä–Ω–æ—Å—Ç—å –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö",
        "–≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º—Å—Ç–≤–æ –∏ —Ä–∞–¥—É—à–∏–µ –∫ –≥–æ—Å—Ç—è–º",
        "–º–∏—Ä –≤ –¥–æ–º–µ –∏ —Å–µ–º–µ–π–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ",
        "–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –æ–±—â–∏–Ω–æ–π –∏ –Ω–∞—Ä–æ–¥–æ–º",
        "–ø—Ä–∏–º–∏—Ä–µ–Ω–∏–µ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤",
        "–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫—Ä–µ–ø–∫–∏—Ö —Å–≤—è–∑–µ–π —Å –±–ª–∏–∑–∫–∏–º–∏",
        "–∑–∞–±–æ—Ç–∞ –æ –≤–¥–æ–≤–∞—Ö, —Å–∏—Ä–æ—Ç–∞—Ö –∏ –Ω—É–∂–¥–∞—é—â–∏—Ö—Å—è",
        "–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–≤–∞—Ä–∏—â–µ–π –≤ —Ä–∞–¥–æ—Å—Ç–∏ –∏ –ø–µ—á–∞–ª–∏",
        "–µ–¥–∏–Ω—Å—Ç–≤–æ –ø–æ–∫–æ–ª–µ–Ω–∏–π –≤ —Å–µ–º—å–µ",
        "–º—É–¥—Ä–æ—Å—Ç—å –≤ –≤—ã–±–æ—Ä–µ —Å–ø—É—Ç–Ω–∏–∫–∞ –∂–∏–∑–Ω–∏",
        "—Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –ª—é–±–≤–∏ –≤ –¥–æ–º–µ",
        "–ø–µ—Ä–µ–¥–∞—á–∞ —Å–µ–º–µ–π–Ω—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π –¥–µ—Ç—è–º",
        
        # Personal growth and character (20 topics)
        "—Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤",
        "–∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≥–Ω–µ–≤–æ–º –∏ —ç–º–æ—Ü–∏—è–º–∏",
        "—Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ä–ø–µ–Ω–∏—è –≤ –∏—Å–ø—ã—Ç–∞–Ω–∏—è—Ö",
        "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–µ—Ä—ã –≤ —Ç—Ä—É–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã",
        "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –≥–æ—Ä–¥—ã–Ω–∏ –∏ –≤—ã—Å–æ–∫–æ–º–µ—Ä–∏—è",
        "–±–æ—Ä—å–±–∞ —Å –ª–µ–Ω—å—é –∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π",
        "—Ä–∞–∑–≤–∏—Ç–∏–µ —â–µ–¥—Ä–æ—Å—Ç–∏ –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏ —Å–µ—Ä–¥—Ü–∞",
        "–∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ —á–µ—Å—Ç–Ω–æ—Å—Ç—å —Å —Å–∞–º–∏–º —Å–æ–±–æ–π",
        "—É–º–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å –¥—Ä—É–≥–∏—Ö",
        "—Å–∏–ª–∞ –≤–æ–ª–∏ –∏ —Å–∞–º–æ–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞",
        "—Å–∫—Ä–æ–º–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏",
        "–±–ª–∞–≥–æ—Ä–æ–¥—Å—Ç–≤–æ –¥—É—à–∏ –∏ –≤–æ–∑–≤—ã—à–µ–Ω–Ω—ã–µ –ø–æ–º—ã—Å–ª—ã",
        "–º—É–¥—Ä–æ—Å—Ç—å –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π",
        "—Ä–∞–∑–≤–∏—Ç–∏–µ —ç–º–ø–∞—Ç–∏–∏ –∏ —Å–æ—á—É–≤—Å—Ç–≤–∏—è",
        "–ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ –≤ –¥—É—Ö–æ–≤–Ω–æ–º —Ä–æ—Å—Ç–µ",
        "–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏",
        "–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–≤–æ–±–æ–¥–∞ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥—É—Ö–∞",
        "—Ä–∞–∑–≤–∏—Ç–∏–µ –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ —á—É—Ç—å—è",
        "—Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—É—Ç–∏",
        "—Ä–∞–¥–æ—Å—Ç—å –æ—Ç —Å–∞–º–æ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏—è",
        
        # Torah study and practice (15 topics)
        "–≥–ª—É–±–∏–Ω–∞ –∏–∑—É—á–µ–Ω–∏—è –¢–æ—Ä—ã –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–º—ã—Å–ª–æ–≤",
        "–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É—á–µ–Ω–∏—è –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏",
        "—Ä–∞–¥–æ—Å—Ç—å –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø–æ–≤–µ–¥–µ–π",
        "–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö —Å–º—ã—Å–ª–æ–≤ –ü–∏—Å–∞–Ω–∏—è",
        "–º—É–¥—Ä–æ—Å—Ç—å –¢–∞–ª–º—É–¥–∞ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –º–∏—Ä–µ",
        "–∫–∞–±–±–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —É—á–µ–Ω–∏—è –æ —Ç–≤–æ—Ä–µ–Ω–∏–∏",
        "—Ö–∞—Å–∏–¥—Å–∫–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∏—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ",
        "—É—á–µ–Ω–∏—è –≤–µ–ª–∏–∫–∏—Ö —Ä–∞–≤–≤–∏–Ω–æ–≤ –ø—Ä–æ—à–ª–æ–≥–æ",
        "—Ç–∞–π–Ω—ã –µ–≤—Ä–µ–π—Å–∫–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤",
        "–¥—É—Ö–æ–≤–Ω—ã–π —Å–º—ã—Å–ª —Ä–∏—Ç—É–∞–ª–æ–≤ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–π",
        "–º—É–¥—Ä–æ—Å—Ç—å –ü–∏—Ä–∫–µ–π –ê–≤–æ—Ç –≤ –∂–∏–∑–Ω–∏",
        "—Å–≤—è–∑—å –º–µ–∂–¥—É –∑–∞–ø–æ–≤–µ–¥—è–º–∏ –∏ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è–º–∏",
        "–ø–æ–Ω–∏–º–∞–Ω–∏–µ –ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ü—Ä–æ–≤–∏–¥–µ–Ω–∏—è",
        "—Ä–æ–ª—å –º–æ–ª–∏—Ç–≤—ã –≤ –¥—É—Ö–æ–≤–Ω–æ–º —Ä–∞–∑–≤–∏—Ç–∏–∏",
        "–º–µ–¥–∏—Ç–∞—Ü–∏—è –∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ –Ω–∞–¥ –¢–æ—Ä–æ–π",
        
        # Life challenges and resilience (15 topics)
        "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π —Å –≤–µ—Ä–æ–π",
        "–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–º—ã—Å–ª–∞ –≤ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è—Ö",
        "—Å–∏–ª–∞ –Ω–∞–¥–µ–∂–¥—ã –≤ —Ç–µ–º–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞",
        "–º—É–¥—Ä–æ—Å—Ç—å –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ –ø–æ—Ç–µ—Ä—å",
        "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á",
        "—Ç–µ—Ä–ø–µ–Ω–∏–µ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–π",
        "–¥–æ–≤–µ—Ä–∏–µ –∫ –í—Å–µ–≤—ã—à–Ω–µ–º—É –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏",
        "–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ –≤–æ —Ç—å–º–µ",
        "–ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
        "–º—É–∂–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥ –ª–∏—Ü–æ–º —Å—Ç—Ä–∞—Ö–∞",
        "—Å—Ç–æ–π–∫–æ—Å—Ç—å –¥—É—Ö–∞ –≤ –±–µ–¥—Å—Ç–≤–∏—è—Ö",
        "–æ–±—Ä–µ—Ç–µ–Ω–∏–µ –ø–æ–∫–æ—è —Å—Ä–µ–¥–∏ —Ö–∞–æ—Å–∞",
        "–≤–µ—Ä–∞ –≤ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –¢–≤–æ—Ä—Ü–∞",
        "–ø—Ä–∏–Ω—è—Ç–∏–µ –ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–æ–ª–∏",
        "—Ä–∞–¥–æ—Å—Ç—å –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
        
        # Daily living and mindfulness (15 topics)
        "–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –≤ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –¥–Ω—è",
        "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —Ä–∞–¥–æ—Å—Ç–∏",
        "—Å–≤—è—Ç–æ—Å—Ç—å –≤ –æ–±—ã–¥–µ–Ω–Ω—ã—Ö –¥–µ–ª–∞—Ö",
        "–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–æ–π –∏ –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å—é",
        "–∑–∞–±–æ—Ç–∞ –æ –∑–¥–æ—Ä–æ–≤—å–µ —Ç–µ–ª–∞ –∏ –¥—É—à–∏",
        "–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏",
        "–º—É–¥—Ä–æ—Å—Ç—å –≤ —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏",
        "—ç—Ç–∏–∫–∞ –≤ –¥–µ–ª–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö",
        "—á–µ—Å—Ç–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏",
        "–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ë–æ–≥–∞ –≤ –ø—Ä–∏—Ä–æ–¥–µ",
        "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å",
        "–≤–Ω–∏–º–∞–Ω–∏–µ –∫ –º–µ–ª–æ—á–∞–º –∫–∞–∫ –ø—É—Ç—å –∫ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É",
        "–ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ —á–∏—Å—Ç–æ—Ç–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π",
        "—Ä–∞–¥–æ—Å—Ç—å –≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π",
        "–ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ —Ä—É—Ç–∏–Ω—ã –≤ —Å–≤—è—â–µ–Ω–Ω–æ–µ —Å–ª—É–∂–µ–Ω–∏–µ"
    ]
    
    # EXPANDED: Day-specific wisdom topics with more variety (10+ per day)
    DAY_SPECIFIC_TOPICS = {
        'monday': [
            "–Ω–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è –∏ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –Ω–µ–¥–µ–ª–∏",
            "—ç–Ω–µ—Ä–≥–∏—è –Ω–æ–≤–æ–≥–æ –¥–Ω—è –∏ –¥—É—Ö–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏", 
            "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ —Å –º—É–¥—Ä–æ—Å—Ç—å—é –¢–æ—Ä—ã",
            "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∫–∞–∫ –≤—Ä–µ–º—è –Ω–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π",
            "—Å–≤–µ–∂–∏–π —Å—Ç–∞—Ä—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π",
            "–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—É—Ö–æ–≤–Ω—ã—Ö —Ü–µ–ª–µ–π –Ω–∞ –Ω–µ–¥–µ–ª—é",
            "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –Ω–∞—á–∏–Ω–∞–Ω–∏–π",
            "–º—É–¥—Ä–æ—Å—Ç—å –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Å–∏–ª –Ω–∞ –Ω–µ–¥–µ–ª—é",
            "—Ä–∞–¥–æ—Å—Ç—å –æ—Ç –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π",
            "–≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è —Ç—Ä—É–¥–∞",
            "—Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ—è –Ω–∞ –Ω–µ–¥–µ–ª—é"
        ],
        'tuesday': [
            "—Ç–µ—Ä–ø–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –≤ –¥–µ–ª–∞—Ö",
            "–º—É–¥—Ä–æ—Å—Ç—å –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö",
            "–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–æ–π –∏ –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å—é",
            "–≤—Ç–æ—Ä–Ω–∏–∫ –∫–∞–∫ –¥–µ–Ω—å –¥—É—Ö–æ–≤–Ω–æ–≥–æ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è",
            "—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ –≤ —Å–ª—É–∂–µ–Ω–∏–∏",
            "—Ä–∞–∑–≤–∏—Ç–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–∏–ª—ã –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏",
            "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π —Å –≤–µ—Ä–æ–π",
            "–Ω–∞—Ö–æ–¥—á–∏–≤–æ—Å—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á",
            "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–º —Ç—Ä—É–¥–µ",
            "—Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º",
            "–º—É–¥—Ä–æ—Å—Ç—å –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏"
        ],
        'wednesday': [
            "—Å–µ—Ä–µ–¥–∏–Ω–∞ –Ω–µ–¥–µ–ª–∏ –∏ –¥—É—Ö–æ–≤–Ω—ã–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è",
            "–º—É–¥—Ä–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏ —Å –ª—é–¥—å–º–∏",
            "—Å–∏–ª–∞ —Å–ª–æ–≤–∞ –∏ –ø—Ä–∞–≤–¥–∏–≤–æ—Å—Ç—å —Ä–µ—á–∏",
            "—Å—Ä–µ–¥–∞ –∫–∞–∫ –≤—Ä–µ–º—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞",
            "–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏–µ–º –∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ–º",
            "–æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø—É—Ç–∏",
            "–≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º–∏",
            "—Å–∏–ª–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è",
            "–º—É–¥—Ä–æ—Å—Ç—å –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏–π",
            "–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø—É—Ç–∏",
            "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –ø—Ä–æ–π–¥–µ–Ω–Ω—É—é –ø–æ–ª–æ–≤–∏–Ω—É –Ω–µ–¥–µ–ª–∏"
        ],
        'thursday': [
            "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –Ω–µ–¥–µ–ª–∏ –∏ –¥—É—Ö–æ–≤–Ω—ã–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è",
            "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –ø—Ä–æ–∂–∏—Ç—ã–µ –¥–Ω–∏",
            "—á–µ—Ç–≤–µ—Ä–≥ –∫–∞–∫ –¥–µ–Ω—å –¥—É—Ö–æ–≤–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏",
            "–º—É–¥—Ä–æ—Å—Ç—å –≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–µ–ª",
            "–ø—Ä–µ–¥–≤–∫—É—à–µ–Ω–∏–µ –®–∞–±–±–∞—Ç–∞ –∏ —Ä–∞–¥–æ—Å—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è",
            "–ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –≤ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á",
            "–±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω–∏–µ –∑–∞ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –Ω–µ–¥–µ–ª–∏",
            "–¥—É—Ö–æ–≤–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–≤—è—Ç–æ–º—É –¥–Ω—é",
            "–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –ª–∏—à–Ω–µ–≥–æ –ø–µ—Ä–µ–¥ –ø–æ–∫–æ–µ–º",
            "—Ä–∞–¥–æ—Å—Ç—å –æ—Ç –ø—Ä–∏–±–ª–∏–∂–∞—é—â–µ–≥–æ—Å—è –æ—Ç–¥—ã—Ö–∞",
            "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ —Å –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ–º"
        ],
        'friday': [
            "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—Å—Ç—Ä–µ—á–µ –®–∞–±–±–∞—Ç–∞ –∏ –¥—É—Ö–æ–≤–Ω–æ–µ –æ—á–∏—â–µ–Ω–∏–µ",
            "–ø—è—Ç–Ω–∏—Ü–∞ –∫–∞–∫ –≤—Ä–µ–º—è –¥—É—Ö–æ–≤–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ—è",
            "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é",
            "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–≤—è—Ç–æ–º—É –¥–Ω—é –ø–æ–∫–æ—è",
            "—Ä–∞–¥–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—á–∏ —Ü–∞—Ä–∏—Ü—ã –®–∞–±–±–∞—Ç",
            "–æ—á–∏—â–µ–Ω–∏–µ –¥–æ–º–∞ –∏ –¥—É—à–∏ –ø–µ—Ä–µ–¥ —Å–≤—è—Ç—ã–º –¥–Ω–µ–º",
            "—Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –º–∏—Ä–∞ –∏ –ª—é–±–≤–∏",
            "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä—É–¥–æ–≤ –Ω–µ–¥–µ–ª–∏ —Å —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ–º",
            "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ —Å–µ–º–µ–π–Ω–æ–≥–æ –æ—á–∞–≥–∞",
            "–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫ –¥—É—Ö–æ–≤–Ω–æ–º—É –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏—é",
            "–ø—Ä–µ–¥–≤–∫—É—à–µ–Ω–∏–µ –®–∞–±–±–∞—Ç–Ω–µ–≥–æ –ø–æ–∫–æ—è –∏ —Å–≤–µ—Ç–∞"
        ],
        'saturday': [
            "—Ä–∞–¥–æ—Å—Ç—å –®–∞–±–±–∞—Ç–∞ –∏ –¥—É—Ö–æ–≤–Ω–æ–µ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏–µ",
            "–¥–µ–Ω—å –ø–æ–∫–æ—è –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
            "—Å—É–±–±–æ—Ç–∞ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥—É—à–µ–≤–Ω–æ–≥–æ –º–∏—Ä–∞",
            "—Å–≤—è—Ç–æ—Å—Ç—å –®–∞–±–±–∞—Ç–∞ –≤ –∂–∏–∑–Ω–∏ –µ–≤—Ä–µ—è",
            "–≥–ª—É–±–æ–∫–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –¢–æ—Ä—ã –≤ —Å–≤—è—Ç–æ–π –¥–µ–Ω—å",
            "—Å–µ–º–µ–π–Ω–æ–µ –µ–¥–∏–Ω—Å—Ç–≤–æ –∏ –±–ª–∏–∑–æ—Å—Ç—å –≤ –®–∞–±–±–∞—Ç",
            "–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç –º–∏—Ä—Å–∫–æ–π —Å—É–µ—Ç—ã",
            "–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥—É—à–∞ –®–∞–±–±–∞—Ç–∞",
            "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è —Å—É–±–±–æ—Ç–Ω–∏—Ö —Ç—Ä–∞–ø–µ–∑",
            "–¥—É—Ö–æ–≤–Ω–æ–µ –≤–æ–∑–≤—ã—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–æ–∫–æ–π",
            "—Ä–∞–¥–æ—Å—Ç—å —Å–ª—É–∂–µ–Ω–∏—è –≤ –¥–µ–Ω—å —Å–≤—è—Ç–æ—Å—Ç–∏",
            "–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–ª –¥–ª—è –Ω–æ–≤–æ–π –Ω–µ–¥–µ–ª–∏"
        ],
        'sunday': [
            "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –∫–∞–∫ –¥–µ–Ω—å —Å–µ–º—å–∏ –∏ –±–ª–∏–∑–æ—Å—Ç–∏",
            "–æ—Ç–¥—ã—Ö –∏ –¥—É—Ö–æ–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ",
            "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –Ω–æ–≤–æ–π –Ω–µ–¥–µ–ª–µ —Å –º—É–¥—Ä–æ—Å—Ç—å—é",
            "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è",
            "–≤—Ä–µ–º—è –¥–ª—è –ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –∏ —Ä–æ—Å—Ç–∞",
            "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–µ–º–µ–π–Ω—ã—Ö —Å–≤—è–∑–µ–π",
            "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–¥—ã—Ö–∞",
            "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É—Ö–æ–≤–Ω—ã—Ö —Ü–µ–ª–µ–π",
            "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ —Ç–µ–ª–∞ –∏ –¥—É—à–∏",
            "—Ä–∞–¥–æ—Å—Ç—å –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π",
            "–ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –ø—Ä–æ—à–µ–¥—à–µ–π –Ω–µ–¥–µ–ª–∏",
            "–Ω–∞—Å—Ç—Ä–æ–π –Ω–∞ –Ω–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"
        ]
    }

    @classmethod
    async def get_unique_topic(cls, db_pool: Optional[asyncpg.Pool], days_back: int = 45, 
                              prefer_contextual: bool = True) -> str:
        """
        Get unique wisdom topic that hasn't been used in recent days
        
        Args:
            db_pool: Database connection pool (can be None for fallback)
            days_back: Number of days to check for uniqueness (INCREASED: 14->45 for better variety)
            prefer_contextual: Whether to prefer day-specific topics when available
            
        Returns:
            str: Unique wisdom topic
        """
        try:
            # Get recent topics from database
            recent_topics = []
            if db_pool:
                try:
                    cutoff_date = date.today() - timedelta(days=days_back)
                    async with db_pool.acquire() as conn:
                        # FIX: Include ALL statuses to prevent duplicates during generation
                        rows = await conn.fetch("""
                            SELECT DISTINCT wisdom_topic 
                            FROM newsletter_broadcasts 
                            WHERE broadcast_date >= $1 
                                AND wisdom_topic IS NOT NULL 
                                AND broadcast_type = 'wisdom'
                                AND status IN ('sent', 'generating', 'ready')
                        """, cutoff_date)
                        recent_topics = [row['wisdom_topic'] for row in rows]
                        logger.info(f"üîç Found {len(recent_topics)} recent wisdom topics in last {days_back} days (all statuses)")
                except Exception as e:
                    logger.warning(f"‚ö†Ô∏è Could not query recent wisdom topics from DB: {e}")
                    recent_topics = []

            # Generate candidate topics
            candidates = cls._generate_candidate_topics(prefer_contextual)
            
            # Filter out recent topics
            unique_candidates = [topic for topic in candidates if topic not in recent_topics]
            
            if unique_candidates:
                selected_topic = choice(unique_candidates)
                logger.info(f"‚ú® Selected unique wisdom topic: '{selected_topic}' ({len(unique_candidates)} candidates available)")
                return selected_topic
            else:
                # Fallback to any base topic if all were used recently
                fallback_topic = choice(cls.BASE_WISDOM_TOPICS)
                logger.warning(f"‚ö†Ô∏è All topics used recently - fallback to: '{fallback_topic}'")
                return fallback_topic
                
        except Exception as e:
            logger.error(f"‚ùå Error generating unique wisdom topic: {e}")
            # Ultimate fallback
            return "–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å –∏ –¥—É—Ö–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç–∞–≤–ª–µ–Ω–∏–µ"

    @classmethod 
    def _generate_candidate_topics(cls, prefer_contextual: bool = True) -> List[str]:
        """Generate list of candidate topics for selection"""
        candidates = cls.BASE_WISDOM_TOPICS.copy()
        
        if prefer_contextual:
            # Add day-specific topics
            current_day = datetime.now().strftime('%A').lower()
            day_topics = cls.DAY_SPECIFIC_TOPICS.get(current_day, [])
            candidates.extend(day_topics)
            
        return candidates

    @classmethod
    async def save_wisdom_topic(cls, db_pool: Optional[asyncpg.Pool], topic: str, 
                               broadcast_date: date, status: str = 'sent') -> bool:
        """
        Save wisdom topic to database for tracking uniqueness
        
        Args:
            db_pool: Database connection pool
            topic: The wisdom topic that was used
            broadcast_date: Date of the broadcast
            
        Returns:
            bool: True if saved successfully, False otherwise
        """
        if not db_pool:
            logger.warning("‚ö†Ô∏è Cannot save wisdom topic - database pool not available")
            return False
            
        try:
            async with db_pool.acquire() as conn:
                # CRITICAL FIX: Only update wisdom_topic field, preserve tracking data (broadcast_id, deliveries, etc)
                # First check if record exists with tracking data
                existing = await conn.fetchrow("""
                    SELECT id, created_by, successful_deliveries 
                    FROM newsletter_broadcasts 
                    WHERE broadcast_date = $1 AND broadcast_type = $2
                """, broadcast_date, 'wisdom')
                
                if existing and existing['created_by'] == 'newsletter_api':
                    # Record created by newsletter_api with tracking - only update wisdom_topic
                    await conn.execute("""
                        UPDATE newsletter_broadcasts 
                        SET wisdom_topic = $1
                        WHERE broadcast_date = $2 AND broadcast_type = $3
                    """, topic, broadcast_date, 'wisdom')
                    logger.info(f"üíæ Updated wisdom topic '{topic}' for tracked broadcast #{existing['id']}")
                else:
                    # No tracking record exists - create basic record
                    await conn.execute("""
                        INSERT INTO newsletter_broadcasts (broadcast_date, broadcast_type, wisdom_topic, status)
                        VALUES ($1, $2, $3, $4)
                        ON CONFLICT (broadcast_date, broadcast_type) 
                        DO UPDATE SET wisdom_topic = $3, status = $4
                    """, broadcast_date, 'wisdom', topic, status)
                    logger.info(f"üíæ Saved wisdom topic '{topic}' for date {broadcast_date}")
                
            return True
            
        except Exception as e:
            logger.error(f"‚ùå Failed to save wisdom topic '{topic}': {e}")
            return False

    @classmethod
    def get_fallback_topic(cls) -> str:
        """Get a safe fallback topic when all else fails"""
        return "–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å –∏ –¥—É—Ö–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç–∞–≤–ª–µ–Ω–∏–µ"

    @classmethod
    async def cleanup_old_topics(cls, db_pool: Optional[asyncpg.Pool], days_to_keep: int = 30) -> int:
        """
        Clean up old wisdom topics to prevent database bloat
        
        Args:
            db_pool: Database connection pool
            days_to_keep: Number of days to keep (default: 30)
            
        Returns:
            int: Number of records cleaned up, -1 if error
        """
        if not db_pool:
            logger.warning("‚ö†Ô∏è Cannot cleanup wisdom topics - database pool not available")
            return -1
            
        try:
            cutoff_date = date.today() - timedelta(days=days_to_keep)
            
            async with db_pool.acquire() as conn:
                result = await conn.execute("""
                    DELETE FROM newsletter_broadcasts 
                    WHERE broadcast_date < $1 AND broadcast_type = 'wisdom'
                """, cutoff_date)
                
            # Extract number from result string like "DELETE 5"
            deleted_count = int(result.split()[-1]) if result and result.split() else 0
            
            if deleted_count > 0:
                logger.info(f"üßπ Cleaned up {deleted_count} old wisdom topic records (older than {cutoff_date})")
            
            return deleted_count
            
        except Exception as e:
            logger.error(f"‚ùå Failed to cleanup old wisdom topics: {e}")
            return -1

# For backward compatibility - can be used directly
async def get_unique_wisdom_topic(db_pool: Optional[asyncpg.Pool] = None, days_back: int = 14) -> str:
    """Convenience function for getting unique wisdom topics"""
    return await WisdomTopicGenerator.get_unique_topic(db_pool, days_back)